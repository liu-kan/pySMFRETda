# Install in windows

Since a dependent package of pySMFRETda is buggy under Windows, you are recommended just running pySMFRETda under [WSL2](https://docs.microsoft.com/en-us/windows/wsl/about) or [Docker for windows](https://docs.docker.com/docker-for-windows/install/) in Windows now. 

If you want to run it natively under Windows, please follow steps below to create python environment using <!--[msys2](https://www.msys2.org/) or -->VC++.
<!--

-----------------------------------------------
## msys2 toolchain
### Prerequisite (msys2)
* Close msys2_shell and run autorebase.bat from cmd in msys2 installation directory, after msys2 installation. 
* Reopen msys2_shell, run ```pacman -Syu``` and ```pacman -S --needed base-devel msys2-devel```.
### virtualenv (msys2)
Install python-pip etc. in msys2
```bash
pacman -S python-pip python-devel protobuf-devel cmake
python3 -m pip install --user pipx
#export PATH=~/.local/bin:$PATH # you can add this line to ~/.bash_profile
python3 -m pipx ensurepath
pipx install virtualenv
virtualenv smfretda
source smfretda/bin/activate
pip install --user numpy protobuf deap
```

### nanomsg-python (msys2)
* Clone [nanomsg](https://github.com/nanomsg/nanomsg), and build the code.
* In nanomsg build directory run ```cmake --install . --prefix /usr``` to install nanomsg in /usr
* Clone [nanomsg-python](https://github.com/tonysimpson/nanomsg-python) code.
* Install nanomsg-python in smfretda environment, by
```bash
python setup.py build
python setup.py install
```

-->
------------------------------------------------------

## Python environment with VC++ toolchain
### Prerequisite (VC++)
Install nanomsg, protobuf from [CONAN](https://conan.io). If you use pySMFRETda with [gSMFRETda](https://github.com/liu-kan/gSMFRETda), and build it from sources, you may already have it.
Install miniconda, and create new environment to run the programm.

### conda (VC++)
* Install Miniconda3 for 64 bits. It should be easily found on https://docs.conda.io/en/latest/miniconda.html.
* Open the "Anaconda Command Prompt," which should be available in the start menu.
* In that command prompt window, use cd to change to the directory where you want to build.
* Now install all of the tools we need:
```bash
conda create --name pyda python=3
activate pyda
conda install numpy protobuf
```

### nanomsg-python (VC++)
* Clone [nanomsg-python](https://github.com/tonysimpson/nanomsg-python) code.
* Change include_dirs in setup.py to the path of real nanomsg include path like ```include_dirs=[r'C:\.conan\6246bf\1\include',]```. It can be found in the file ```conanbuildinfo.cmake```, which was generated by conan install <gSMFRETda_src_dir>
* Copy nanomsg.lib from nanomsg lib path to nanomsg-python source dir.
* Install nanomsg-python in Anaconda Command Prompt with pyda environment, by
```bash
"c:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Auxiliary/Build/vcvars64.bat"
python setup.py build_ext --inplace --compiler=msvc
python setup.py install
```

### deap (VC++)
* Clone [a patched deap](https://github.com/liu-kan/deap) branch, which has merge [PR 76](https://github.com/DEAP/deap/pull/76) from [@cmd-ntrf](https://github.com/cmd-ntrf)
* Install deap in Anaconda Command Prompt with pyda environment, by
```bash
python setup.py install
```
---------------------------------------------------
## FRETBursts (only if you use untils/*.py)
Build [FRETBursts](https://github.com/OpenSMFS/FRETBursts) from [@tritemio](https://github.com/tritemio) in [my repository](https://github.com/liu-kan/FRETBursts), which replace mpl.normpdf with scipy.stats.norm.pdf.
```bash
pip3 uninstall fretbursts # or conda uninstall fretbursts
git clone --depth=1 https://github.com/liu-kan/FRETBursts.git
cd FRETBursts
python3 setup.py build
python3 setup.py install
```